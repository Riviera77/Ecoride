{% extends 'base.html.twig' %}

{% block title %}Carpooling{% endblock %}

{% block body %}
    <div class="container my-5">

        <h1 class="mb-4">D√©tail du covoiturage</h1>

        <div class="card mb-4 overflow-hidden text-bg-dark shadow-lg">
            <div class="card-body">

                <div class="d-flex align-items-center">
                    <img src="{{ asset('uploads/users/' ~ carpooling.users.photo) }}" alt="photo" width="100" height="100" class="rounded-circle me-3">
                    <div>
                        <h3>{{ carpooling.users.username }}</h3>
                        <p>Note moyenne : 
                            {% if averageRating > 0 %}
                                ‚≠ê {{ averageRating }}/5
                            {% else %}
                                Pas encore not√©
                            {% endif %}
                        </p>
                    </div>
                </div>

                <hr>

                <p><strong>Ville de d√©part :</strong> {{ carpooling.departureAddress }}</p>
                <p><strong>Ville d'arriv√©e :</strong> {{ carpooling.arrivalAddress }}</p>
                <p><strong>Date de d√©part :</strong> {{ carpooling.departureDate ? carpooling.departureDate|date('Y-m-d') : '' }}</p>
                <p><strong>Date d'arriv√©e :</strong>{{ carpooling.arrivalDate ? carpooling.arrivalDate|date('Y-m-d') : '' }}</p>
                
                <p><strong>Heure de d√©part :</strong> {{ carpooling.departureTime ? carpooling.departureTime|date('H:i:s') : '' }}</p>
                <p><strong>Heure d'arriv√©e :</strong> {{ carpooling.arrivalTime ? carpooling.arrivalTime|date('H:i:s') : '' }}</p>
                <p><strong>Dur√©e estim√©e :</strong> {{ carpooling.duration ?? 'Non pr√©cis√©e' }}</p>
                <p><strong>Prix :</strong> {{ carpooling.price }} ‚Ç¨</p>
                <p><strong>Nombre de places restantes :</strong> {{ carpooling.numberSeats - carpooling.passengers|length }}</p>
                <p><strong>Pr√©f√©rences :</strong> {{ carpooling.preference ?? 'Aucune' }}</p>
                <p><strong>Statut :</strong> {{ carpooling.status }}</p>

                <hr>

                <h4>V√©hicule</h4>
                {% if carpooling.cars %}
                    <p><strong>Mod√®le :</strong> {{ carpooling.cars.model }}</p>
                    <p><strong>Marque :</strong> {{ carpooling.cars.mark }}</p>
                    <p><strong>√ânergie :</strong> {{ carpooling.cars.energy ? '‚ö° √âlectrique' : 'Essence/Diesel' }}</p>
                {% else %}
                    <p>Pas de v√©hicule renseign√©</p>
                {% endif %}

                <hr>

                <h4>Commentaires des passagers</h4>
                {% if comments is not empty %}
                    <ul>
                        {% for comment in comments %}
                            <li>üí¨ {{ comment.comment }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Aucun commentaire pour ce conducteur.</p>
                {% endif %}

            </div>
        </div>

        <a href="{{ path('app_carpooling_index') }}" class="btn btn-primary">Retour √† la liste des covoiturages</a>

        {% if app.user %}
            {% set alreadyPassenger = carpooling.passengers.contains(app.user) %}
            {% if alreadyPassenger %}
                <div class="alert alert-info mt-3">
                    Vous participez d√©j√† √† ce covoiturage.
                </div>
            {% elseif carpooling.numberSeats > 0 %}
                <a href="{{ path('app_carpooling_participate', { id: carpooling.id }) }}" class="btn btn-primary mt-3">
                    Participer √† ce covoiturage
                </a>
            {% else %}
                <div class="alert alert-warning mt-3">
                    Il n'y a plus de places disponibles.
                </div>
            {% endif %}
            {% else %}
                <div class="card my-4 overflow-hidden text-bg-dark shadow-lg">
                    <a href="{{ path('app_login') }}">Connectez-vous</a> ou 
                    <a href="{{ path('app_register') }}">cr√©ez un compte</a> pour participer √† ce covoiturage.
                </div>
        {% endif %}

        <a href="{{ path('app_carpooling_edit', {'id': carpooling.id}) }}" class="btn btn-primary">Modifier</a>
    </div>

    {{ include('carpooling/_delete_form.html.twig') }}
{% endblock %}
